#set -euxo pipefail
. .demo-env

read -rp "sns handover smiley_dapp smiley_dapp_assets"

SNS_ROOT="$(jq -r .sns_root[env.DFX_NETWORK] canister_ids.json)"
DAPP_BACKEND="$(jq -r .smiley_dapp[env.DFX_NETWORK] canister_ids.json)"
DAPP_FRONTEND="$(jq -r .smiley_dapp_assets[env.DFX_NETWORK] canister_ids.json)"

PRINCIPAL=$(dfx identity --network "$DFX_NETWORK" get-principal)
WALLET_CANISTER="$(dfx identity --network "$DFX_NETWORK" get-wallet)"


for CANISTER in "$DAPP_FRONTEND" "$DAPP_BACKEND" ; do
        dfx canister --network $DFX_NETWORK status $CANISTER
        dfx canister --network $DFX_NETWORK update-settings $CANISTER --add-controller $SNS_ROOT
        dfx canister --network $DFX_NETWORK update-settings $CANISTER --remove-controller $WALLET_CANISTER
        dfx canister --network $DFX_NETWORK update-settings $CANISTER --remove-controller $PRINCIPAL
        dfx canister --network $DFX_NETWORK call sns_root register_dapp_canister "(record {canister_id = opt principal \"${CANISTER}\" } )"
done
dfx canister --network $DFX_NETWORK call sns_root list_sns_canisters '(record {} )'
