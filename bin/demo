#!/usr/bin/env bash
set -euo pipefail

if test -f .demo-env
then . .demo-env
fi

esay() {
  echo -- "${@}"
  say "${@}"
}

esay "Cleaning up..."
./bin/demo-cleanup
clear
read -rp "Press enter to start..."
clear

esay "First the developer needs a testnet.  This doesn't work on localhost yet"
read -rp "FUTURE: dfx start --clean --with-nns"
./bin/dfx-start-clean-with-nns

esay "The developer needs to install tooling for the sns"
read -rp "FUTURE: dfx install-plugin sns"

esay "They also need to create users to represent the voting public"
read -rp "FUTURE: dfx crowdcontrol new"
./bin/dfx-crowdcontrol-new

esay "They need to deploy their dapp to the testnet if they haven't done so already"
read -rp "dfx deploy --all"
./bin/create-dapp

esay "Next configure the SNS"
./bin/configure-sns

esay "Deploy the SNS"
./bin/sns-deploy

esay "Surrender control of the dapp to the SNS"
read -rp "sns handover "
./bin/sns-handover

esay "Propose to start the sale"
: "Note: This may become a new-edit-validate-deploy path."
read -rp "sns start-swap "
bin/sns-start-swap

esay "Now you need to invest"
read -rp "Open the nns-dapp or OpenChat and invest."
bin/demo-invest

esay "Finalize the sale"
read -rp "sns finalize-swap "
bin/sns-finalize-swap

esay "The user should have neurons now"
read -rp "See the dapp in nns-dapp... "
./bin/demo-see-sns-in-nns

read -rp "See the dapp in nns-openchat... "
./bin/demo-see-sns-in-oc


echo
echo FIN
